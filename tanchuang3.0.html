<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语录弹窗小游戏</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "微软雅黑", sans-serif;
        }
        body {
            height: 100vh;
            background-color: #000;
            background-image: none; /* 初始无背景图 */
            background-size: cover; /* 背景图自适应 */
            background-position: center; /* 背景图居中 */
            background-repeat: no-repeat; /* 不重复 */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
            transition: background-color 0.5s ease, background-image 0.5s ease;
        }
        /* 配置面板样式 */
        .config-panel {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 500px;
            display: block;
            z-index: 999;
        }
        .config-panel.hidden {
            display: none;
        }
        /* 显示面板的按钮 */
        .show-panel-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #4285f4;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            z-index: 998;
        }
        .show-panel-btn.show {
            display: block;
        }
        .config-item {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, textarea, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        textarea {
            height: 100px;
            resize: none;
        }
        button {
            background-color: #4285f4;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #3367d6;
        }
        /* 背景图片上传样式 */
        .upload-img {
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            margin-top: 5px;
        }
        .upload-img:hover {
            background-color: #f5f5f5;
        }
        #imgUpload {
            display: none; /* 隐藏原生上传按钮 */
        }
        /* 弹窗通用样式 */
        .popup {
            position: absolute;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 24px;
            z-index: 9999;
            cursor: move;
            color: #000;
        }
        /* 初始弹窗样式 */
        .init-popup {
            width: 450px;
            height: 180px;
            background-color: #87CEEB;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: #000;
        }
    </style>
</head>
<body>
    <!-- 配置面板 -->
    <div class="config-panel" id="configPanel">
        <div class="config-item">
            <label for="initText">初始弹窗文字：</label>
            <input type="text" id="initText" placeholder="输入初始弹窗显示的文字" value="傻逼作者傻逼文">
        </div>
        <div class="config-item">
            <label for="customQuotes">自定义语录（每行一句）：</label>
            <textarea id="customQuotes" placeholder="比如：
为师知道，为师愿意
从前种种，今日一并还你
我和师尊的关系就像鱼和水">为师知道，为师愿意
从前种种，今日一并还你
我和师尊的关系就像鱼和水
我没了师尊就死了，师尊没了我，还清净
世人流传的故事已经结束
我只为一人，别的一概不知
这一次，无论你想去什么地方，为师都陪着
即便为师出事，你也不会有任何不测
我每一时、每一刻，脑子里想的都是师尊
心魔皆因执念起</textarea>
        </div>
        <div class="config-item">
            <label for="popupCount">弹窗数量：</label>
            <input type="number" id="popupCount" value="50" min="1" max="200">
        </div>
        <div class="config-item">
            <label for="bgColor">背景颜色（优先于背景图）：</label>
            <input type="color" id="bgColor" value="#000000">
        </div>
        <div class="config-item">
            <label>背景图片上传（支持JPG/PNG/GIF）：</label>
            <div class="upload-img" onclick="document.getElementById('imgUpload').click()">
                点击上传背景图片
            </div>
            <input type="file" id="imgUpload" accept="image/jpeg,image/png,image/gif">
            <p style="font-size: 12px; color: #999; margin-top: 5px;">仅支持JPG、PNG、GIF格式，大小建议不超过5MB</p>
        </div>
        <button id="startBtn">开始</button> <!-- 改成“开始” -->
    </div>

    <!-- 重新配置按钮 -->
    <button class="show-panel-btn" id="showPanelBtn">重新配置</button>

    <script>
        // 颜色列表
        const COLORS = [
            "#FFB6C1", "#87CEEB", "#90EE90", "#E6E6FA",
            "#87CEFA", "#FFFFE0", "#DDA0DD", "#FF7F50"
        ];

        // 全局变量
        let initPopup = null;
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let bgImageUrl = null; // 存储背景图URL

        // 获取DOM元素
        const startBtn = document.getElementById('startBtn');
        const initTextInput = document.getElementById('initText');
        const customQuotesInput = document.getElementById('customQuotes');
        const popupCountInput = document.getElementById('popupCount');
        const bgColorInput = document.getElementById('bgColor');
        const imgUpload = document.getElementById('imgUpload');
        const configPanel = document.getElementById('configPanel');
        const showPanelBtn = document.getElementById('showPanelBtn');

        // 监听背景图片上传
        imgUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // 验证文件格式（防止非图片文件）
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
            if (!allowedTypes.includes(file.type)) {
                alert('仅支持JPG、PNG、GIF格式的图片！');
                return;
            }

            // 生成图片预览URL
            const reader = new FileReader();
            reader.onload = function(e) {
                bgImageUrl = e.target.result; // 存储图片的Base64 URL
                alert('背景图片上传成功！点击开始即可生效');
            };
            reader.readAsDataURL(file);
        });

        // 开始按钮点击事件
        startBtn.addEventListener('click', () => {
            // 隐藏面板，显示重新配置按钮
            configPanel.classList.add('hidden');
            showPanelBtn.classList.add('show');

            // 设置背景：颜色优先，图片次之
            document.body.style.backgroundColor = bgColorInput.value;
            if (bgImageUrl) {
                document.body.style.backgroundImage = `url(${bgImageUrl})`;
            } else {
                document.body.style.backgroundImage = 'none';
            }

            // 清除旧弹窗
            document.querySelectorAll('.popup').forEach(p => p.remove());

            // 获取用户配置
            const initText = initTextInput.value.trim() || "默认文字";
            const quotes = customQuotesInput.value.trim().split('\n').filter(q => q);
            const popupCount = parseInt(popupCountInput.value) || 50;

            // 创建初始弹窗
            createInitPopup(initText, quotes, popupCount);
        });

        // 重新配置按钮
        showPanelBtn.addEventListener('click', () => {
            configPanel.classList.remove('hidden');
            showPanelBtn.classList.remove('show');
        });

        // 创建初始弹窗
        function createInitPopup(initText, quotes, popupCount) {
            initPopup = document.createElement('div');
            initPopup.className = 'popup init-popup';
            initPopup.innerHTML = `
                <span class="close-btn">×</span>
                <div>${initText}</div>
            `;
            document.body.appendChild(initPopup);

            // 关闭按钮事件
            const closeBtn = initPopup.querySelector('.close-btn');
            closeBtn.addEventListener('click', () => {
                initPopup.remove();
                createQuotePopups(quotes, popupCount);
            });

            // 可拖动
            makeDraggable(initPopup);
        }

        // 批量创建语录弹窗
        function createQuotePopups(quotes, count) {
            if (quotes.length === 0) {
                alert('请至少输入一句语录！');
                return;
            }

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    createSingleQuotePopup(quotes);
                }, i * 50);
            }
        }

        // 创建单个语录弹窗
        function createSingleQuotePopup(quotes) {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            const color = COLORS[Math.floor(Math.random() * COLORS.length)];

            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.style.width = '450px';
            popup.style.height = '180px';
            popup.style.backgroundColor = color;
            popup.innerHTML = `<div>${quote}</div>`;

            const screenWidth = window.innerWidth - 450;
            const screenHeight = window.innerHeight - 180;
            const x = Math.floor(Math.random() * screenWidth);
            const y = Math.floor(Math.random() * screenHeight);
            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;

            document.body.appendChild(popup);
            makeDraggable(popup);

            // 点击关闭
            popup.addEventListener('click', (e) => {
                if (!isDragging) {
                    popup.remove();
                }
            });
        }

        // 可拖动函数
        function makeDraggable(element) {
            element.addEventListener('mousedown', (e) => {
                isDragging = true;
                dragOffsetX = e.clientX - element.getBoundingClientRect().left;
                dragOffsetY = e.clientY - element.getBoundingClientRect().top;
                element.style.zIndex = 10001;
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const x = e.clientX - dragOffsetX;
                    const y = e.clientY - dragOffsetY;
                    element.style.left = `${x}px`;
                    element.style.top = `${y}px`;
                    element.style.transform = 'none';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }
    </script>
</body>
</html>